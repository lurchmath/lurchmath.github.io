<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Lurch validation engine: utils/math-live.js</title>
    
      <link type="text/css" rel="stylesheet" href="styles/vendor/prism-default.css">
    
    <link type="text/css" rel="stylesheet" href="styles/styles.css">
    
    
    <style>
      :root {
      
      
        --nav-width: 335px;
      
      }
    </style>
    
</head>
<body>

<header class="layout-header">
  
  <h1>
    <a href="./index.html">
      Lurch validation engine
    </a>
  </h1>
  <nav class="layout-nav">
    <ul><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="CNFProp.html">CNFProp</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="CNFProp.html#.switchVarSymbol">switchVarSymbol</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#hasCNFform">hasCNFform</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#simplify">simplify</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#toAlgebraic">toAlgebraic</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#toArray">toArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#toEnglish">toEnglish</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#.fromLC">fromLC</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#.toCNF">toCNF</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="CNFProp.html#.toVar">toVar</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="module-MathLive.MathItem.html">MathItem</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-MathLive.MathItem.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-MathLive.MathItem.html#setFocusWhenShown">setFocusWhenShown</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-MathLive.MathItem.html#setValue">setValue</a></span></li></ul><ul><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-GlobalValidation.html">GlobalValidation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~cacheFormulaDomainInfo">cacheFormulaDomainInfo</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~copyEquation">copyEquation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~diff">diff</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~forbiddenWeeny">forbiddenWeeny</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~getCaselikeRules">getCaselikeRules</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~getUserPropositions">getUserPropositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~insertInstantiation">insertInstantiation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~insertSymmetricEquivalences">insertSymmetricEquivalences</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~instantiate">instantiate</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~instantiateTransitives">instantiateTransitives</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~isBadInstantiation">isBadInstantiation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~matchGivens">matchGivens</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~matchPropositions">matchPropositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~processBIHs">processBIHs</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~processCases">processCases</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~processDomains">processDomains</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~processEquations">processEquations</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~reverseEquation">reverseEquation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~splitEquations">splitEquations</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~tidyProperNames">tidyProperNames</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-GlobalValidation.html#~validate">validate</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-Interpretation.html">Interpretation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~addSystemDeclarations">addSystemDeclarations</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~assignProperNames">assignProperNames</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~interpret">interpret</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~markDeclaredSymbols">markDeclaredSymbols</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~moveDeclaresToTop">moveDeclaresToTop</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~processBindings">processBindings</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~processDeclarationBodies">processDeclarationBodies</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~processLetEnvironments">processLetEnvironments</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~processRules">processRules</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~processTheorems">processTheorems</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~renameBindings">renameBindings</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Interpretation.html#~replaceBindings">replaceBindings</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-Lode.html">Lode</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Lode.html#~list">list</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-MathLive.html">MathLive</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="module-MathLive.html#.inputFormats">inputFormats</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="module-MathLive.html#.outputFormats">outputFormats</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="module-MathLive.html#.stylesheet">stylesheet</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-MathLive.html#.getConverter">getConverter</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-Parsing.html">Parsing</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Parsing.html#.makeParser">makeParser</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Parsing.html#.processShorthands">processShorthands</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-Reporting.html">Reporting</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-Utilities.html">Utilities</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="module-Utilities.html#.isOnScreen">isOnScreen</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.appURL">appURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.copyWithoutPrototype">copyWithoutPrototype</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.editorForNode">editorForNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.escapeHTML">escapeHTML</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.loadScript">loadScript</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.onlyBefore">onlyBefore</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.removeScriptTags">removeScriptTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#.simpleHTMLTable">simpleHTMLTable</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~checkExtension">checkExtension</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~checkFolder">checkFolder</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~commonInitialSlice">commonInitialSlice</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~indent">indent</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~lineNum">lineNum</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~rgb2hex">rgb2hex</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~subscript">subscript</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~tab">tab</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-Utilities.html#~timer">timer</a></span></li></ul><ul><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="Extensions.html">Extensions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Declaration#allProps">Declaration#allProps</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Declaration#letsInScope">Declaration#letsInScope</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Declaration#lookup">Declaration#lookup</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Declaration#prop">Declaration#prop</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Environment#catalog">Environment#catalog</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Environment#cnf">Environment#cnf</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Environment#letInferences">Environment#letInferences</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Environment#scopes">Environment#scopes</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Expression#allProps">Expression#allProps</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Expression#lookup">Expression#lookup</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.Expression#prop">Expression#prop</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#Declares">LogicConcept#Declares</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#Insts">LogicConcept#Insts</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#Parts">LogicConcept#Parts</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#Rules">LogicConcept#Rules</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#attributes">LogicConcept#attributes</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#bindings">LogicConcept#bindings</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#declarations">LogicConcept#declarations</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#descendantsSatisfyingIterator">LogicConcept#descendantsSatisfyingIterator</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#environments">LogicConcept#environments</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#equations">LogicConcept#equations</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#find">LogicConcept#find</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#forSomes">LogicConcept#forSomes</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#formulas">LogicConcept#formulas</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#insertAfter">LogicConcept#insertAfter</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#insertBefore">LogicConcept#insertBefore</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isAComment">LogicConcept#isAComment</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isADeclaration">LogicConcept#isADeclaration</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isALet">LogicConcept#isALet</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isALetEnvironment">LogicConcept#isALetEnvironment</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isAProposition">LogicConcept#isAProposition</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isAStatement">LogicConcept#isAStatement</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#isAnEquation">LogicConcept#isAnEquation</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#letAncestors">LogicConcept#letAncestors</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#lets">LogicConcept#lets</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#mentions">LogicConcept#mentions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#negate">LogicConcept#negate</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#propositions">LogicConcept#propositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#results">LogicConcept#results</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#root">LogicConcept#root</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#setResult">LogicConcept#setResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#slice">LogicConcept#slice</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#some">LogicConcept#some</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#statements">LogicConcept#statements</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#symbols">LogicConcept#symbols</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#toAlgebraic">LogicConcept#toAlgebraic</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#toEnglish">LogicConcept#toEnglish</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#toNice">LogicConcept#toNice</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LogicConcept#toggleGiven">LogicConcept#toggleGiven</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LurchSymbol#properName">LurchSymbol#properName</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Extensions.html#.LurchSymbol#rename">LurchSymbol#rename</a></span></li></ul><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="global.html#LurchOptions">LurchOptions</a></span></li>
  </nav>
</header>


<main class="layout-main  layout-content--source">
  <div class="container">
    <p class="page-kind">source</p>
    <h1 class="page-title">utils/math-live.js</h1>
    



    

<section>
    <article>
        <pre id="source" class="source-page line-numbers"><code class="language-js">
/**
 * This module loads scripts from the MathLive library (from
 * https://cortexjs.io/mathlive/), and then creates from it several different
 * tools useful in the Lurch application.
 * 
 * First, it creates the {@link MathItem} class, which can be added to
 * {@link Dialog} instances as an input component containing an equation editor.
 * (Note that I say "equation editor" here because that is common parlance, but
 * of course one can use it for many types of mathematical expressions, not just
 * equations.)
 * 
 * Second, it creates a function for converting among various math notation
 * formats.  See {@link module:MathLive.getConverter getConverter()} for
 * details.
 * 
 * @module MathLive
 */

import { loadScript } from './utilities.js'
import asciiMathToLatex from '../parsers/asciimath-to-latex.js'

// Internal use only.
// Ensures the MathLive scripts are loaded, so you can do whatever you want with
// the stuff they install in the global (window) object thereafter.
const loadMathFieldClass = () =>
    loadScript( 'https://unpkg.com/mathlive@0.100.0' ).then( () =>
    loadScript( 'https://unpkg.com/@cortex-js/compute-engine@0.24.1' ) )

/**
 * We store here the URL to the MathLive CSS stylesheet, so that we can define
 * it in only one location and others can reference it from here.
 * 
 * @type {string}
 */
export const stylesheet = 'https://unpkg.com/mathlive@0.100.0/dist/mathlive-static.css'

/**
 * An item that can be used in a {@link Dialog} and shows up as an equation
 * editor powered by a MathLive math editing component.
 */
export class MathItem {

    /**
     * Construct a MathLive editing component.
     * 
     * @param {string} name - the name of the control in the dialog, used for
     *   querying its value when the dialog closes, or providing an initial
     *   value when the dialog opens
     * @param {string} label - the label to show next to the math ediitor in the
     *   user interface
     */
    constructor ( name, label ) {
        this.name = name
        this.label = label
        this.setupInitiated = false
        this.mathLiveEditor = null
        this.mathValue = null
        this.focusWhenShown = false
    }

    /**
     * Whether to focus this item once it has loaded.  Defaults to `false`, so
     * as to not interfere with the usual focus mechanics of the {@link Dialog}
     * class.  However, because this component is a unique one, the normal focus
     * mechanics will not work for it, so you should call this function to
     * override them if you want this item to receive focus once it has been
     * installed into the dialog.
     * 
     * @param {boolean} value - whether to focus this item once it appears
     */
    setFocusWhenShown ( value ) { this.focusWhenShown = value }

    // internal use only; creates the JSON to represent this object to TinyMCE
    // (actually, it creates an HTML element that will LATER be populated
    // programmatically with a MathLive editor)
    json () {
        return [
            {
                type : 'htmlpanel',
                html : `
                    &lt;label class='tox-label'>${this.label}&lt;/label>
                    &lt;div id='math-${this.name}'>Loading editor...&lt;/div>
                `
            }
        ]
    }

    // Internal use only.
    // Stores the current value of the MathLive editor, as a LaTeX string,
    // because once the editor is closed, you can't get this value back.  So we
    // need to store it somewhere for retrieval even after the editor closes.
    saveValue () {
        if ( this.mathValue != this.mathLiveEditor?.value ) {
            this.mathValue = this.mathLiveEditor?.value
            this.dialog.onChange( this.dialog, this )
        }
    }
    // Internal use only; how to fetch the value stored by saveValue().
    savedValue () { return this.mathValue }

    /**
     * Set the current contents of the editor to the expression represented in
     * the given LaTeX content.
     * 
     * @param {string} value - LaTeX content to be put into the MathLive editor
     */
    setValue ( value ) {
        this.mathLiveEditor.value = value
        this.saveValue()
    }

    // Called whenever the dialog is shown (or, if this item is inside a tab,
    // whenever that tab is shown).  This is what initializes the MathLive
    // editor into the DIV created by the `json()` method, and installs an
    // event handler that calls saveValue() whenever an edit takes place.
    onShow () {
        if ( this.setupInitiated ) return
        this.setupInitiated = true
        loadMathFieldClass().then( () => {
            document.body.style.setProperty( '--keyboard-zindex', '2000' )
            this.mathLiveEditor = new MathfieldElement()
            this.mathLiveEditor.value = this.dialog.json.initialData[this.name] || ''
            this.mathLiveEditor.style.width = '100%'
            this.mathLiveEditor.style.border = 'solid 1px #cccccc'
            const insertHere = document.getElementById( `math-${this.name}` )
            while ( insertHere.firstChild )
                insertHere.removeChild( insertHere.firstChild )
            insertHere.appendChild( this.mathLiveEditor )
            delete this.mathLiveEditor.shadowRoot.querySelector(
                '.ML__virtual-keyboard-toggle' ).dataset['ml__tooltip']
            this.saveValue()
            this.mathLiveEditor.addEventListener( 'input',
                () => this.saveValue() )
            if ( this.focusWhenShown )
                this.mathLiveEditor.focus()
        } )
    }

    /**
     * Get the saved value of the equation editor, as a LaTeX string.
     * 
     * @param {string} key - the key whose value should be looked up
     * @returns {string?} the value associated with the given key, if the key
     *   is the one that this item is in charge of editing, or undefined
     *   otherwise
     */
    get ( key ) { if ( key == this.name ) return this.savedValue() }

}

// Internal use only.
// MathJSON is a format invented by the author of MathLive, and documented here:
// https://cortexjs.io/math-json/
// 
// This function converts the given MathJSON structure to putdown notation.
// It is not exported by this module.  Instead, to be able to use it, you should
// asynchronously construct a converter object using getConverter(), below.
const mathJSONToPutdown = json => {
    // MathJSON numbers come in 3 formats:
    // 1. plain numbers
    if ( !isNaN( json ) ) return `${json}`
    // 2. object literals with a "num" field
    if ( json.num ) return `${json.num}`
    // 3. a string starting with +, -, or a digit 0-9
    if ( ( typeof( json ) == 'string' ) &amp;&amp; '+-0123456789'.includes( json[0] ) )
        return json
    // MathJSON strings come in 2 formats:
    // 1. a string with a leading and trailing apostrophe
    if ( ( typeof( json ) == 'string ' )
      &amp;&amp; ( json[0] == '\'' ) &amp;&amp; ( json[json.length - 1] == '\'' ) )
        return JSON.parse( json )
    // 2. object literals with a "str" field
    if ( json.str ) return json.str
    // MathJSON symbols come in 2 formats:
    // 1. a string that doesn't match the format for strings given above
    if ( typeof( json ) == 'string' ) return json
    // 2. an object literal with a "sym" field
    if ( json.sym ) return json.sym
    // MathJSON function applications come in 3 formats:
    // 1. a JavaScript array
    if ( json instanceof Array )
        return '(' + json.map( mathJSONToPutdown ).join( ' ' ) + ')'
    // 2. object literals with a "fn" field
    if ( json.fn )
        return '(' + json.fn.map( mathJSONToPutdown ).join( ' ' ) + ')'
    // MathJSON also supports dictionaries, but putdown does not.
    // So every other kind of MathJSON object just gets called "unsupported":
    return `(unsupported_MathJSON ${JSON.stringify( json )})`
}

/**
 * An array of names of all the input formats known by the converter defined in
 * {@link module:MathLive.getConverter getConverter()}.
 */
export const inputFormats = [ 'latex', 'mathjson', 'asciimath' ]

/**
 * An array of names of all the output formats known by the converter defined in
 * {@link module:MathLive.getConverter getConverter()}.
 */
export const outputFormats = [ 'html', 'putdown', ...inputFormats ]

// Internal use only
// LaTeX commands not parseable by MathLive, but that we need to have parsed.
// This string is used later to convert all such commands in to plain \text{...}
// blocks, so that they go through the MathLive parser, and we can manipulate
// them after the JSON/putdown/LC form has been created.
const unsupportedLatexCommands = `forall exists`

/**
 * A converter is a function with the following signature:
 * `convert( data, 'input format', 'output format' )`.
 * For example, to convert some $\LaTeX$ code to putdown, you might do the
 * following.
 * 
 * ```js
 * getConverter().then( convert => {
 *     const putdown = convert( someLaTeXString, 'latex', 'putdown' )
 *     console.log( putdown )
 * } )
 * ```
 * 
 * Thre are five formats that this function knows about.  Two are output-only
 * formats: `'html'` and `'putdown'`.  You cannot convert from these formats
 * into any other format.  The other three are storage formats: `'latex'`,
 * `'mathjson'`, and `'asciimath'`.  The formats are case-insensitive, so you
 * can write `'LaTeX'` or `'MathJSON'` instead if you like.  All of the three
 * storage formats can be converted into one another, and into any of the
 * output formats.  So the only constraint is that the output format cannot be
 * `'html'` or `'putdown'`.
 * 
 * The reason that this function is asynchronous is because some of those
 * conversion functions can be run only once MathLive has been loaded, and so
 * this function ensures that has happened before returning to you a converter
 * instance.  That way, the instance you receive is guaranteed to work
 * immediately, and all of its methods can be synchronous.  Note that many of
 * the conversion functions are built into MathLive, and I'm simply making them
 * available here and connecting them in all the transitive ways the user might
 * need them.
 * 
 * @returns {Promise} a promise that resolves to a function that behaves as above
 * @function
 */
export const getConverter = () => loadMathFieldClass().then( () => {
    // Define the function here that we will return, so that we have a name to
    // us inside of it for recursive calls.
    const convert = ( data, inputFormat, outputFormat ) => {
        // Ensure that .json doesn't convert 1/2 to "Half"
        MathfieldElement.computeEngine.jsonSerializationOptions.exclude = [ 'Half' ]
        // (Tried to put that code outside the function but it was too soon; not sure why.)
        inputFormat = inputFormat.toLowerCase()
        outputFormat = outputFormat.toLowerCase()
        if ( !inputFormats.includes( inputFormat ) )
            throw new Error( `Invalid input format: ${inputFormat}` )
        if ( !outputFormats.includes( outputFormat ) )
            throw new Error( `Invalid output format: ${outputFormat}` )
        // handle trivial case
        if ( inputFormat == outputFormat )
            return data
        // handle all other cases
        switch ( `${inputFormat} ${outputFormat}` ) {
            case 'latex putdown':
                return convert( convert( data, 'latex', 'mathjson' ),
                    'mathjson', 'putdown' )
            case 'latex html':
                return MathLive.convertLatexToMarkup( data )
            case 'latex mathjson':
                unsupportedLatexCommands.trim().split( /\s+/ )
                .forEach( latexCommand =>
                    data = data.replace(
                        RegExp( '\\\\'+latexCommand+'\\b', 'g' ),
                        `\\text{${latexCommand}}` ) )
                return MathfieldElement.computeEngine.parse(
                    data, { canonical: false } ).json
            case 'latex asciimath':
                return MathLive.convertLatexToAsciiMath( data )
            case 'mathjson latex':
                return MathLive.serializeMathJsonToLatex( data )
            case 'mathjson html':
                return convert( convert( data, 'mathjson', 'latex' ),
                    'latex', 'putdown' )
            case 'mathjson putdown':
                return mathJSONToPutdown( data )
            case 'mathjson asciimath':
                return convert( convert( data, 'mathjson', 'latex' ),
                    'latex', 'asciimath' )
            case 'asciimath latex':
                return asciiMathToLatex( data )
                    // Handle unnecessary brackets around symbols:
                    // (These can cause spacing problems in some cases.)
                    .replace( /[{](\w)[}]/g, ' $1 ' )
                    // MathLive-specific preferences for special sets:
                    .replace( /\\mathbb\s+Q/g, '\\Q' )
                    .replace( /\\mathbb\s+R/g, '\\R' )
                    .replace( /\\mathbb\s+C/g, '\\C' )
                    .replace( /\\mathbb\s+Z/g, '\\Z' )
                    .replace( /\\mathbb\s+N/g, '\\N' )
            case 'asciimath html':
                return convert( convert( data, 'asciimath', 'latex' ),
                    'latex', 'html' )
            case 'asciimath putdown':
                return convert( convert( data, 'asciimath', 'mathjson' ),
                    'mathjson', 'putdown' )
            case 'asciimath mathjson':
                return convert( convert( data, 'asciimath', 'latex' ),
                    'latex', 'mathjson' )
            default: throw new Error(
                `Unsupported conversion: ${inputFormat} -> ${outputFormat}` )
        }
    }
    // Return the function we just built.
    return convert
} )
</code></pre>
    </article>
</section>




  </div>
</main>

<footer class="layout-footer">
  <div class="container">
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a>
  </div>
</footer>



<script src="scripts/prism.dev.js"></script>
</body>
</html>
